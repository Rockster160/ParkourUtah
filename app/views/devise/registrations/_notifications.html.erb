<%= form_tag "/user/notifications/update" do %>
  <div class="modal fade" id="notification_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="standard-modal modal-dialog central-container">
      <button type="button" class="close-btn" data-dismiss="modal" aria-hidden="true"><%= icon("times-circle-o", '', class: 'fa-2x') %></button>
      <h1 class="pkut-header hidden-xs">Notifications</h1>
      <h4 class="pkut-header visible-xs">Notifications</h4>
      <p>Receive Notifications for:</p>
      <div class="row">
        <div class="col-xs-4">
        </div>
        <div class="col-xs-4">
          Email
        </div>
        <div class="col-xs-4">
          Text
        </div>
      </div>

      <div class="row">
        <div class="col-xs-4">
          Waiver Expiring
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[email_waiver_expiring]", '', current_user.notifications.email_waiver_expiring? %>
            <%= label_tag "notify[email_waiver_expiring]", '' %>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[text_waiver_expiring]", '', current_user.notifications.text_waiver_expiring? %>
            <%= label_tag "notify[text_waiver_expiring]", '' %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-4">
          Class Reminders
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[email_class_reminder]", '', current_user.notifications.email_class_reminder? %>
            <%= label_tag "notify[email_class_reminder]", '' %>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[text_class_reminder]", '', current_user.notifications.text_class_reminder? %>
            <%= label_tag "notify[text_class_reminder]", '' %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-4">
          Low on credits
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[email_low_credits]", '', current_user.notifications.email_low_credits? %>
            <%= label_tag "notify[email_low_credits]", '' %>
          </div>
        </div>
        <div class="col-xs-4">
          <div class="pkut-checkbox">
            <%= check_box_tag "notify[text_low_credits]", '', current_user.notifications.text_low_credits? %>
            <%= label_tag "notify[text_low_credits]", '' %>
          </div>
        </div>
      </div>

      <% unless current_user.notifications.sms_receivable %>
        <div class="row" style="color: orange">
          <h4>You have blacklisted text notifications from ParkourUtah! You will not receive any text alerts.</h4>
          <h5>To un-blacklist us, simply text the word 'start' to +1 (740) 571-4304 and then click the button below.</h5>
          <h5>You should receive a text message saying you will now be able to receive text notifications from ParkourUtah.</h5>
        </div>
        <div class="row">
          <%= link_to 'Text Me!', make_sms_receivable_path, class: 'pkut-btn', remote: true, method: :post %>
        </div>
      <% end %>


      <%= submit_tag "Update", class: 'pkut-btn' %>
      <% if current_user.subscriptions_cost > 0 %>
        <hr>
        <div class="row">
            <p>You are currently set up to auto-pay for monthly subscriptions.</p>
            <% current_user.subscribed_athletes.sort_by {|a|a.subscription.expires_at}.each do |athlete| %>
            <% subscription = athlete.subscription %>
              <div class="row">
                <div class="col-xs-6">
                  <p>The next payment of <%= number_to_currency(subscription.cost) %> for <%= athlete.full_name %> will process on <%= (subscription.expires_at + 1.day).strftime('%B %e, %Y') %>.</p>
                </div>
                <div class="col-xs-6">
                  <%= link_to 'Unsubscribe', unsubscribe_monthly_subscription_path(athlete.id), class: 'pkut-btn', method: :delete %>
                </div>
              </div>
            <% end %>
            <p>
        </div>
      <% end %>
      <% if current_user.athletes_with_unlimited_access.count > 0 %>
        <hr>
        <% current_user.athletes_with_unlimited_access.each do |athlete| %>
          <div class="row">
            <p><%= athlete.full_name %> has unlimited classes until: <%= athlete.subscription.expires_at.strftime('%B %e, %Y') %></p>
          </div>
        <% end %>
      <% end %>
      <hr>
      <div class="row">
        <p>Classes subscribed to:</p>
        <% current_user.class_subscriptions.map{|s|s.event}.each do |event| %>
          <div class="row">
            <div class="col-xs-6">
              <%= event.city %> <%= event.class_name.capitalize %> <%= event.date.strftime('%l:%M') %>
            </div>
            <div class="col-xs-6">
              <%= link_to 'Unsubscribe', unsubscribe_path(id: event.id), class: 'pkut-btn', method: :delete %>
            </div>
          </div>
          <br/>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
